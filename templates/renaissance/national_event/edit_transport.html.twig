{% extends 'renaissance/national_event/_inscription_layout.html.twig' %}

{% block background_image '' %}
{% block body_classes 'bg-ui_gray-5' %}

{% block header %}
    <header class="flex py-10 md:py-20 justify-center w-full">
        {% if event.logoImage %}
            <img class="max-h-36" src="{{ vich_uploader_asset(event.logoImage) }}" alt="logo"/>
        {% else %}
            <a href="{{ path('renaissance_site') }}">
                <img src="{{ asset('/images/renaissance/logo-dark.svg') }}" alt="logo" />
            </a>
        {% endif %}
    </header>
{% endblock %}

{% block content_section %}
    <div
        class="flex flex-col md:flex-row gap-8 justify-center items-center md:items-start w-full px-5 pb-20"
        x-data="xNationalEventPage({initialPackageValues: {{ inscription.packageValues|json_encode }}, discountLabel: '{{ event.discountLabel|e('js') }}', discountFactor: {{ event.getDiscountFactor() }}, initialPayedAmount: {{ inscription.getAmountInEuro()|default(0) }}, uncheckInputs: false, packageConfig: {{ event.packageConfig|json_encode }}})"
    >
        {{ form_start(form, {attr: {class: 'max-w-[500px]'}}) }}
            <div class="flex flex-col gap-8">
                <div class="!rounded-2xl !gap-6">
                    {{ include('renaissance/partials/flashes.html.twig', {slim: true}) }}

                    <p class="font-medium text-2xl text-ui_gray-80">Changer de forfait</p>

                    {{ form_errors(form) }}
                </div>

                {% set packageConfig = event.packageConfig %}

                {% for child in form.packageValues %}
                    <twig:Atoms:ReCard class="!rounded-2xl !gap-6" x-show="availabilities['{{ child.vars.name }}']" x-cloak>
                        {{ form_row(child) }}
                    </twig:Atoms:ReCard>
                {% endfor %}

                <twig:Atoms:ReCard class="!rounded-2xl !gap-6">
                    <div class="bg-ui_gray-1 rounded-lg p-6 flex flex-col gap-4" x-show="getSummaryItems().length > 0">
                        {{ form_row(form.withDiscount, {label: event.discountLabel ?? 'Étudiant, demandeur d’emploi ou bénéficiaire des minimas sociaux ? Vous bénéficiez de -50%', attr: {
                            widget_side: 'right',
                            'x-model': 'withDiscount',
                        }}) }}

                        {% if event.discountHelp %}
                            <div class="text-ui_gray-60 formatted-text">
                                {{ event.discountHelp|raw|nl2br }}
                            </div>
                        {% endif %}
                    </div>

                    {% if inscription.isPaymentSuccess() %}
                        <twig:ReParagraphStatus status="info" icon="info" x-show="isFromPayedToFreeUpdate()">
                            Le nouveau forfait est gratuit.<br/>Nous ne remboursons pas automatiquement les inscriptions.
                        </twig:ReParagraphStatus>

                        <twig:ReParagraphStatus status="warning" icon="warning" x-show="isFromPayedToPayedUpdate()">
                            Le nouveau forfait doit être réglé en totalité.<br/>L’ancien vous sera remboursé sous 30 jours.
                        </twig:ReParagraphStatus>
                    {% endif %}

                    <div class="flex flex-col  bg-ui_gray-1 rounded-lg p-6 gap-4" x-show="getSummaryItems().length > 0">
                        <twig:Atoms:ReLabel class="text-gray-950">Récapitulatif</twig:Atoms:ReLabel>

                        <template x-for="item in getSummaryItems()" :key="item.label">
                            <div class="grid grid-cols-[5fr_1fr] gap-2 items-center">
                                <span x-text="item.label"></span>
                                <span class="text-right" :class="item.price < 0 ? 'text-ui_green-50' : 'text-ui_blue-50'" x-text="item.price.toLocaleString() + ' €'"></span>
                            </div>
                        </template>

                        <div class="grid grid-cols-[5fr_1fr] gap-2 mt-1 items-center">
                            <span class="font-medium text-ui_gray-80">Montant total</span>
                            <span class="font-medium text-ui_gray-80 text-right" x-text="getTotalPrice().toLocaleString() + ' €'"></span>
                        </div>
                    </div>

                    <twig:ReButton class="w-full" color="blue" disabled="x:!hasChanged()">Modifier ma réservation</twig:ReButton>

                    <twig:ReButton tag="a" href="{{ path('app_national_event_my_inscription', {slug: event.slug, uuid: inscription.uuid}) }}" class="w-full" color="white">Annuler</twig:ReButton>
                </twig:Atoms:ReCard>
            </div>
        {{ form_end(form) }}
    </div>
{% endblock %}

{% extends 'base_renaissance.html.twig' %}

{% block page_title 'Adhésion' %}

{% block content %}
    <main class="bg-[#F4F4F7] re_new_ui">
        <section class="flex flex-col justify-center items-center gap-10">
            <twig:Atoms:ReCard class="max-w-[540px] !sticky !rounded-t-0 top-0 z-50">
                <nav>
                    <ol class="breadcrumb">
                        <li>Adresse e-mail</li>
                        <li>Mes information</li>
                        <li>Légalités</li>
                        <li>Montant</li>
                    </ol>
                </nav>
            </twig:Atoms:ReCard>


            <div class="flex-col justify-start items-start gap-8 inline-flex">

                {% form_theme form 'renaissance/forms/tailwind_form_theme.html.twig' %}

                {{ form_start(form) }}
                <div class="flex gap-8 flex-col">
                    <twig:Atoms:ReCard class="max-w-[500px]" x-data="FirstFormStep" id="step_1">
                        <template x-if="generalNotification">
                            <twig:Atoms:ReParagraphStatus
                                    xSyncStatus="generalNotification.status"
                                    x-text="generalNotification.message"/>
                        </template>

                        {{ form_row(form.email, {
                            attr: {
                                placeholder: 'Adresse mail',
                                validate:"['required', 'email']",
                                autocomplete: 'email',
                                onCheck:"setFieldValid('email')",
                            }, label: false}) }}

                        {{ form_row(form.consentDataCollect, {
                            attr: {
                                validate: "['required']",
                                onCheck: "setFieldValid('consentDataCollect')",
                            },
                            label: 'Je consent au traitement de mes données personnelles'
                        }) }}

                        <div class="w-full re-field-frame !h-auto cursor-pointer"
                             x-on:click="dom('.frc-button')?.click()">
                            {% include 'renaissance/partials/friendly-captcha.html.twig' %}
                        </div>

                        <twig:Molecules:ReButton
                            color="blue"
                            value="J'adhère"
                            class="w-full"
                            x-bind:class="{disabled: !checkValidity()}"
                            x-on:click="handleOnSubmit($event, $dispatch)"
                            xSyncLoading="loading"
                        />

                        <p class="text-center">
                            Vous préférez adhérer par voie postale ?<br/>
                            Télécharger le formulaire d’adhésion papier !
                        </p>

                        <div class="flex justify-center items-center">
                            <twig:Molecules:ReButton
                                tag="a"
                                href="https://storage.googleapis.com/parti-renaissance.fr/Renaissance-Bulletin-adhesion.pdf"
                                target="_blank"
                                color="not-fill"
                                value="Télécharger"
                                class="!w-auto"
                                icon="download"
                            />
                        </div>
                        <hr/>

                        <twig:Atoms:ReParagraphStatus status="info">
                            Une question relative à l’adhésion ? <br>
                            Écrivez-nous à <a class="text-ui_blue-50" href="mailto:adherents@parti-renaissance.fr">adherents@parti-renaissance.fr</a>
                        </twig:Atoms:ReParagraphStatus>

                    </twig:Atoms:ReCard>

                    <twig:Atoms:ReCard class="max-w-[500px]" id="step_2" x-data="SecondFormStep">
                        {{ form_row(form.civility, {
                            label: 'Mes informations',
                            attr: { onCheck:"setFieldValid('gender')", validate: "['required']" }
                        }) }}
                        <div class="flex-row flex gap-5">
                            {{ form_row(form.lastName, {
                                label: false,
                                attr: { placeholder: 'Nom', onCheck:"setFieldValid('lastName')", validate: "['required', 'min:2', 'max:50']" }
                            }) }}
                            {{ form_row(form.firstName, {
                                label: false,
                                attr: { placeholder: 'Prénom', onCheck:"setFieldValid('firstName')", validate: "['required', 'min:1', 'max:50']" }
                            }) }}
                        </div>

                        {{ form_row(form.nationality, {
                            label: 'Nationalité',
                            attr: { onCheck:"setFieldValid('nationality')", validate: "['required']" }
                        }) }}

                        {{ form_row(form.address, {label: 'Adresse postale'}) }}

                        <twig:Molecules:ReButton
                            color="blue"
                            value="Suivant"
                            class="w-full"
                            x-on:click="handleOnSubmit($event, $dispatch)"
                            x-bind:class="{disabled: !checkValidity()}"
                        />
                    </twig:Atoms:ReCard>

                    <twig:Atoms:ReCard class="max-w-[500px]" id="step_3" x-data="ThirdFormStep">
                             {{ form_row(form.exclusiveMembership, {
                                 label: 'Autorisation',
                                 attr:{
                                     'x-on:change':'handleExclusiveMembershipChange($event)',
                                     validate:"['required']",
                                     onCheck: 'setFieldValid("exclusiveMembership")'
                                 }
                             }) }}
                        <div x-show="notExclusiveMember" x-cloak class="flex flex-col gap-8">
                            <hr>
                            {{ form_row(form.partyMembership, {
                                label: "J'appartiens déjà à un parti politique :",
                                attr:{
                                    'x-on:change':'handlePartyMembershipChange($event)',
                                    validate:"['?:notExlusiveMember', 'required']",
                                    onCheck: 'setFieldValid("partyMembership")'
                                }
                            }) }}
                        </div>


                        <hr>

                        <div class="flex flex-col gap-8">
                            <template x-if="isMemberOfAnotherParty && notExclusiveMember" x-cloak>
                                <twig:Atoms:ReParagraphStatus status="warning" icon="warning">
                                    Si vous êtes déjà affilié à un parti politique, il vous est impossible de devenir membre de Renaissance. Toutefois, il vous est tout à fait possible d'exprimer votre soutien en tant que sympathisant.
                                </twig:Atoms:ReParagraphStatus>
                                <twig:Atoms:ReLabel>En devenant sympathisant :</twig:Atoms:ReLabel>
                            </template>

                            <template x-if="!(isMemberOfAnotherParty && notExclusiveMember)">
                                <twig:Atoms:ReLabel>En adhérant :</twig:Atoms:ReLabel>
                            </template>

                            {{ form_row(form.allowNotifications, {
                                label: 'Je souhaite recevoir les informations sur l’actualité de Renaissance et ses communications politiques par e-mail'
                            }) }}
                        </div>
                        {{ form_row(form.isPhysicalPerson, {
                            label: 'adhesion.physical_person.label', label_html: true,
                            attr: { onCheck:"setFieldValid('isPhysicalPerson')", validate: "['required']" }
                        }) }}


                        <template x-if="isMemberOfAnotherParty && notExclusiveMember" x-cloak>
                            <twig:Molecules:ReButton
                                color="yellow"
                                value="Je deviens sympathisant"
                                class="w-full"
                                x-on:click="handleOnSubmit($event, $dispatch)"
                                x-bind:class="{disabled: !checkValidity()}"
                            />
                        </template>

                        <template x-if="!(isMemberOfAnotherParty && notExclusiveMember)">
                            <twig:Molecules:ReButton
                                color="blue"
                                value="J’adhère"
                                class="w-full"
                                x-on:click="handleOnSubmit($event, $dispatch)"
                                x-bind:class="{disabled: !checkValidity()}"
                            />
                        </template>
                    </twig:Atoms:ReCard>

                    <twig:Atoms:ReCard class="max-w-[500px] !h-[30vh]" id="fake_email_validation">
                       fake  Verification de l'email
                    </twig:Atoms:ReCard>

                    <div class="spacer h-[50vh]"></div>
                </div>
                <input type="hidden" id="email-validation-token" value="{{ email_validation_token }}"/>
            </div>
            {{ form_end(form) }}
        </section>
    </main>
{% endblock %}

{% block final_javascripts %}
    <script type="module" src="{{ asset('js/friendlycaptcha.widget-0.9.14.module.min.js') }}" async defer></script>
    <script>
        Bootstrap.onLoad(() => Main.runAdhesionPage('{{ google_maps_api_key }}'));
    </script>
{% endblock %}
